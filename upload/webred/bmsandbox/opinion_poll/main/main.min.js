$.ajax({type:"GET",url:"../parties.xml",dataType:"xml",cache:!0,success:function(a){for(var b,c=$(a).find("party").sort(function(a,b){var c=$(b).find("letter").text(),d=$(a).find("letter").text();return c>d?-1:d>c?1:0}),d=c.length;d--;)b=parseFloat($("id",c[d]).text()),partyData[b]=[],partyData[b].id=b,partyData[b].color=$("color",c[d]).text(),partyData[b].letter=$("letter",c[d]).text(),partyData[b].name=$("name",c[d]).text(),partyData[b].shortname=$("shortname",c[d]).text(),partyDataOrder.push(b);installation()}});var sourcePicker=$('<ul id="source-picker"></ul>'),sourcePickerContent,partyData=[],partyDataOrder=[],months=[];months[1]="januar",months[2]="febuar",months[3]="marts",months[4]="april",months[5]="maj",months[6]="juni",months[7]="juli",months[8]="august",months[9]="september",months[10]="oktober",months[11]="november",months[12]="december";var pollofpollsText=function(a,b){return"Det v\xe6gtede gennemsnit viser et gennemsnit af de "+a+" politiske meningsm\xe5linger, der er blevet offentliggjort 31 dage fra den "+b+". Da nye meningsm\xe5linger vejer tungere end \xe6ldre, er Barometerets gennemsnit udtryk for en v\xe6gtet tendens, som giver dig et mere retvisende bud p\xe5 partiernes reelle opbakning end enkeltst\xe5ende meningsm\xe5linger."},installation=function(){for(var e,a=partyData.length-1,b=$("#chart").width()/a,c=b-b/2,d="",f=a;f--;)e=partyDataOrder[f],d+='<div class="party '+partyData[e].id+'" style="left: '+c+'px">',d+='<span class="letter" style="background-color:'+partyData[e].color+'">'+partyData[e].letter+"</span>",d+='<div class="hover-name">'+partyData[e].name+"</div>",d+='<span class="second-letter" style="background-color:'+partyData[e].color+'"></span>',d+='<div class="bar" style="background-color:'+partyData[e].color+'"></div>',d+='<div class="second-bar" style="background-color:'+partyData[e].color+'"></div>',d+='<p class="procent"></p>',d+='<p class="second-procent"></p>',d+="</div>",c+=b;$("#chart").append(d),sourceMenu()},sourceMenu=function(){var a,b,c,d,e,f,g=(new Date).getFullYear(),h=1,i=!1;$.ajax({type:"GET",url:"../overview.xml",dataType:"xml",cache:!0,success:function(j){sourcePickerContent=$('<li id="all"></li>'),sourcePickerContent.append("<h4>Seneste m\xe5linger</h4>"),sourcePickerContent.append('<ul class="sub-menu"></ul>');for(var k=g;k>=2010;k--)$.ajax({type:"GET",url:"../"+k+"/all.xml",dataType:"xml",async:!1,cache:i,success:function(a){sourceMenuItems("all","Seneste m\xe5linger",$(a).find("poll")),i=!0}});sourcePicker.append(sourcePickerContent),sourcePickerContent=$('<li id="pollofpolls"></li>'),sourcePickerContent.append("<h4>V\xe6gtet gennemsnit</h4>"),sourcePickerContent.append('<ul class="sub-menu"></ul>'),i=!1;for(var k=g;k>=2010;k--)$.ajax({type:"GET",url:"../"+k+"/pollofpolls.xml",dataType:"xml",async:!1,cache:i,success:function(g){1===h&&(a=$(g).find("datetime:first").text().split(" "),b=a[0].split("-"),c=parseFloat(b[2])+". "+months[parseFloat(b[1])]+" "+b[0]+" ",d=$(g).find("description:first").text(),e=$(g).find("poll:first").find("entry"),f=$(g).find("respondents:first").text(),h=0),sourceMenuItems("pollofpolls","V\xe6gtet gennemsnit",$(g).find("poll")),i=!0}});sourcePicker.append(sourcePickerContent);var l=$(j).find("institute").sort(function(a,b){var c=$(b).find("name").text(),d=$(a).find("name").text();return c>d?-1:d>c?1:0});l.each(function(){sourcePickerContent=$('<li id="'+$(this).find("id").text()+'"></li>'),sourcePickerContent.append("<h4>"+$(this).find("name").text()+"</h4>"),sourcePickerContent.append('<ul class="sub-menu"></ul>'),i=!1;for(var a=$("xml",this).length;a--;){var b=$("xml",this).eq(a).find("url").text();b=b.replace("http://www.berlingske.dk/upload/webred/bmsandbox/opinion_poll/","../"),$.ajax({type:"GET",url:b,dataType:"xml",async:!1,cache:i,success:function(a){sourceMenuItems($(a).find("institute").find("id").text(),$(a).find("institute").find("name").text(),$(a).find("poll")),i=!0}})}"Valgresultater"===$(this).find("name").text()?$("#pollofpolls",sourcePicker).after(sourcePickerContent):sourcePicker.append(sourcePickerContent)})}}),$("#container").ajaxStop(function(){$("#menu").append(sourcePicker),$("#source-picker .sub-menu").sbscroller(),$("#source-picker").accordion(),addEvents(),mainPoll("pollofpolls","V\xe6gtet gennemsnit",c,e,pollofpollsText(d,c),f),$("#loader").fadeOut(900)})},sourceMenuItems=function(a,b,c){for(var d=0;d<c.length;d++){var e=$("datetime",c[d]).text().split(" "),f=e[0].split("-"),g=parseFloat(f[2])+". "+months[parseFloat(f[1])]+" "+f[0]+" ",h=g,i=$("description:first",c[d]).text();"all"==a&&(b=$("name:first",c[d]).text(),h=b+" "+g),"pollofpolls"==a&&(i=pollofpollsText(i,h)),$(".sub-menu",sourcePickerContent).append('<li><a href="#">'+h+"</a></li>"),$(".sub-menu li:last a",sourcePickerContent).click({id:a,name:b,displayDatetime:g,poll:$("entries",c[d]).find("entry"),description:i,respondents:$("respondents:first",c[d]).text()},function(a){var b=$(".source-button.active").parent().attr("id");sourcePicker.hide(),$(".source-button").removeClass("active"),"main-poll"==b?mainPoll(a.data.id,a.data.name,a.data.displayDatetime,a.data.poll,a.data.description,a.data.respondents):secondPoll(a.data.id,a.data.name,a.data.displayDatetime,a.data.poll,a.data.description,a.data.respondents)})}},addEvents=function(){$(".info-button").click(function(){$(this).hasClass("active")?($(this).animate({top:20},500),$(this).parent().find(".info").slideUp(500,function(){}),$(this).removeClass("active")):($(this).animate({top:$(this).parent().find(".info").height()+32},500),$(this).parent().find(".info").slideDown(500,function(){}),$(this).addClass("active"))}),"ontouchstart"in window==!0&&$(".scroll-content").draggable({axis:"y",drag:function(a,b){var c=b.position,d=$(this).height()-100,e=$(this).parent().find(".ui-slider-handle"),f=d-Math.abs(c.top),g=100*(f/d);return $(e).css("bottom",g+"%"),c.top>0||c.top<-d?!1:void 0}}),$(".source-button").click(function(a){var b=$(this).parent().offset();sourcePicker.css({top:b.top+20,left:b.left}).show(),$("#source-picker .sub-menu").css({width:$(this).parent().width()-5}),$("#source-picker .scroll-content").css({width:$(this).parent().width()-15}),$(".source-button").removeClass("active"),$(this).addClass("active"),a.stopPropagation()}),sourcePicker.bind("touchmove touchstart click",function(a){a.stopPropagation()}),$("html").bind("touchmove touchstart click",function(){sourcePicker.hide(),$(".source-button").removeClass("active")}),$("#procent-toggle, #mandates-toggle").click(function(){$("#procent-toggle").hasClass("active")?$("#uncertainty-toggle").css({opacity:.4}):$("#uncertainty-toggle").css({opacity:1}),$("#uncertainty-toggle").toggleClass("disabled"),$("#chart .party").each(function(){$("#uncertainty-toggle").hasClass("active")&&$("#chart .party").each(function(){$(".procent, .second-procent",this).toggleClass("uncertainty")});var a=$(".bar",this).height(),b=$(".procent",this).css("top"),c=$(".procent",this).html();if($(".bar",this).animate({height:$(".bar",this).attr("altHeight")},300,function(){$(this).attr("altHeight",a)}),$(".procent",this).html($(".procent",this).attr("altValue")),$(".procent",this).css({marginLeft:-($(".procent",this).width()-23)/2}),$(".procent",this).animate({top:$(".procent",this).attr("altTop")},300,function(){$(this).attr("altTop",b),$(this).attr("altValue",c)}),""!==$("#chart .party:first .second-procent").text()){var d=$(".second-bar",this).height(),e=$(".second-procent",this).css("top"),f=$(".second-procent",this).html();$(".second-bar",this).animate({height:$(".second-bar",this).attr("altHeight")},300,function(){$(this).attr("altHeight",d)}),$(".second-procent",this).html($(".second-procent",this).attr("altValue")),$(".second-procent",this).css({marginLeft:-($(".second-procent",this).width()-23)/2}),$(".second-procent",this).animate({top:$(".second-procent",this).attr("altTop")},300,function(){$(this).attr("altTop",e),$(this).attr("altValue",f)})}}),$("#blockview-first-bottom div, #blockview-second-bottom div, #blockview-top div").each(function(){var a=$(".procent",this).html();$(".procent",this).html($(".procent",this).attr("altValue")),$(".procent",this).attr("altValue",a)}),$("#procent-toggle, #mandates-toggle").toggleClass("active")}),$("#uncertainty-toggle").click(function(){return $(this).hasClass("disabled")?!1:($("#chart .party").each(function(){$(".procent, .second-procent",this).toggleClass("uncertainty")}),$("#uncertainty-toggle").toggleClass("active"),void 0)}),$(".party").bind("mouseover mouseout",function(){var a=$(".hover-name",this).width();$(".hover-name",this).css("left","-"+(a-22)/2+"px").toggle()})},mainPoll=function(a,b,c,d,e,f){$("#main-poll .source-button, #blockview-first-bottom .red .info").html("Loader..."),$("#main-poll .info").hide(),$("#main-poll .info-button").css({top:20}).hide();for(var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,g=0,h=0,i=0,j=0,k="",l="",m="blue",D=d.length;D--;){n=parseFloat($("id",d[D]).text()),o=245*(parseFloat($("percent",d[D]).text())/60),p=245*(parseFloat($("mandates",d[D]).text())/60),q=-o-70,r=-p-70,s=partyData[n].shortname,$("#procent-toggle").hasClass("active")?(t=o,u=q,v=p,w=r,x=$("percent",d[D]).text().replace(".",","),y=$("mandates",d[D]).text()):(t=p,u=r,v=o,w=q,x=$("mandates",d[D]).text(),y=$("percent",d[D]).text().replace(".",","));var E=$("uncertainty",d[D]).text();$(".party."+n+" .bar").attr("altHeight",v),$(".party."+n+" .procent").attr({altTop:w,altValue:y,"data-content":E}).html(x),$(".party."+n+" .procent").css({marginLeft:-($(".party."+n+" .procent").width()-23)/2}),$(".party."+n+" .procent").animate({top:u},700),$(".party."+n+" .bar").animate({height:t},700),1==$("supports",d[D]).text()||9==$("supports",d[D]).text()?(g+=parseFloat($("percent",d[D]).text()),i+=parseFloat($("mandates",d[D]).text()),k+=s+", ","A"==$("letter",d[D]).text()&&(m="red")):2==$("supports",d[D]).text()&&(h+=parseFloat($("percent",d[D]).text()),j+=parseFloat($("mandates",d[D]).text()),l+=s+", ")}$("#procent-toggle").hasClass("active")?(z=g.toFixed(1).toString().replace(".",",")+"%",A=h.toFixed(1).toString().replace(".",",")+"%",B=i,C=j):(z=i,A=j,B=g.toFixed(1).toString().replace(".",",")+"%",C=h.toFixed(1).toString().replace(".",",")+"%");var F=100-(g+h);F>0?g+=F:0>F&&(g=F+g),$("#blockview-first-bottom").show(),"red"==m?($("#blockview-first-bottom .red").animate({width:g+"%"},700),$("#blockview-first-bottom .red .procent").attr("altValue",B).html(z),$("#blockview-first-bottom .red .partys").html(k.substr(0,k.length-2)),$("#blockview-first-bottom .blue").animate({width:h+"%"},700),$("#blockview-first-bottom .blue .procent").attr("altValue",C).html(A),$("#blockview-first-bottom .blue .partys").html(l.substr(0,l.length-2))):($("#blockview-first-bottom .red").animate({width:h+"%"},700),$("#blockview-first-bottom .red .procent").attr("altValue",C).html(A),$("#blockview-first-bottom .red .partys").html(l.substr(0,l.length-2)),$("#blockview-first-bottom .blue").animate({width:g+"%"},700),$("#blockview-first-bottom .blue .procent").attr("altValue",B).html(z),$("#blockview-first-bottom .blue .partys").html(k.substr(0,k.length-2))),$(".bar, .red, .blue").promise().done(function(){$("#main-poll .source-button, #blockview-first-bottom .red .info").html(b+" "+c).show(),""===f?$("#main-poll .info-button").hide():($("#main-poll .info").html("<strong>"+f+" respondenter</strong>"+e).width($("#main-poll").width()),$("#main-poll .info-button").show())})},secondPoll=function(a,b,c,d,e,f){$("#second-poll .source-button, #blockview-second-bottom .info").html("Loader..."),$("#second-poll .info").hide(),$("#second-poll .info-button").css({top:20}).hide();for(var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,g=0,h=0,i=0,j=0,k="",l="",m="blue",E=d.length;E--;)n=parseFloat($("id",d[E]).text()),o=245*(parseFloat($("percent",d[E]).text())/60),p=245*(parseFloat($("mandates",d[E]).text())/60),q=-o-55,r=-p-55,s=partyData[n].shortname,$("#procent-toggle").hasClass("active")?(t=o,u=q,v=p,w=r,x="/ "+$("percent",d[E]).text().replace(".",","),y="/ "+$("mandates",d[E]).text()):(t=p,u=r,v=o,w=q,x=$("mandates",d[E]).text(),y=$("percent",d[E]).text().replace(".",",")),D=$("uncertainty",d[E]).text(),$(".party."+n+" .second-bar").attr("altHeight",v),$(".party."+n+" .second-procent").attr({altTop:w,altValue:y,"data-content":D}).html(x).show(),$(".party."+n+" .second-procent").animate({top:u},700),$(".party."+n+" .second-bar").animate({height:t},700),$(".party."+n+" .second-letter").show(),1==$("supports",d[E]).text()||9==$("supports",d[E]).text()?(g+=parseFloat($("percent",d[E]).text()),i+=parseFloat($("mandates",d[E]).text()),k+=s+", ","A"==$("letter",d[E]).text()&&(m="red")):2==$("supports",d[E]).text()&&(h+=parseFloat($("percent",d[E]).text()),j+=parseFloat($("mandates",d[E]).text()),l+=s+", ");$("#procent-toggle").hasClass("active")?(z=g.toFixed(1).toString().replace(".",",")+"%",A=h.toFixed(1).toString().replace(".",",")+"%",B=i,C=j):(z=i,A=j,B=g.toFixed(1).toString().replace(".",",")+"%",C=h.toFixed(1).toString().replace(".",",")+"%");var F=100-(g+h);F>0?g+=F:0>F&&(g=F+g),$("#info").css({marginTop:42}),$("#blockview-second-bottom").show(),"red"==m?($("#blockview-second-bottom .red").animate({width:g+"%"},700),$("#blockview-second-bottom .red .procent").attr("altValue",B).html(z).show(),$("#blockview-second-bottom .red .partys").html(k.substr(0,k.length-2)),$("#blockview-second-bottom .blue").animate({width:h+"%"},700),$("#blockview-second-bottom .blue .procent").attr("altValue",C).html(A).show(),$("#blockview-second-bottom .blue .partys").html(l.substr(0,l.length-2))):($("#blockview-second-bottom .red").animate({width:h+"%"},700),$("#blockview-second-bottom .red .procent").attr("altValue",C).html(A).show(),$("#blockview-second-bottom .red .second-partys").html(l.substr(0,l.length-2)),$("#blockview-second-bottom .blue").animate({width:g+"%"},700),$("#blockview-second-bottom .blue .procent").attr("altValue",B).html(z).show(),$("#blockview-second-bottom .blue .partys").html(k.substr(0,k.length-2))),$(".second-bar, .second-red, .second-blue").promise().done(function(){$("#second-poll .source-button, #blockview-second-bottom .info").html(b+" "+c).show(),""===f?$("#second-poll .info-button").hide():($("#second-poll .info").html("<strong>"+f+" respondenter</strong>"+e).width($("#second-poll").width()),$("#second-poll .info-button").show())})};